<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>英文單字進階測驗（201–400 題庫，隨機抽 20 題）</title>
<style>
  :root { --gap: 10px; }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:#f7f7f8;color:#222;}
  header{padding:18px 20px;background:#fff;border-bottom:1px solid #e6e6e6;position:sticky;top:0;z-index:1}
  h1{font-size:18px;margin:0}
  main{max-width:900px;margin:0 auto;padding:18px}
  .card{background:#fff;border:1px solid #e9e9e9;border-radius:12px;padding:16px;margin-bottom:14px}
  button{border:0;border-radius:10px;padding:10px 14px;cursor:pointer;background:#111;color:#fff}
  button.secondary{background:#fff;color:#111;border:1px solid #ddd}
  .option{display:block;padding:12px;border:1px solid #ddd;border-radius:10px;margin:8px 0;cursor:pointer}
  .option.correct{border-color:#11a911;background:#effaf0}
  .option.wrong{border-color:#e23d3d;background:#fff1f1}
  .hidden{display:none}
  .pill{display:inline-block;padding:4px 10px;border:1px solid #ddd;border-radius:999px;background:#fafafa}
  .muted{color:#666}
  .small{font-size:12px}
  input[type="text"]{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:16px}
  .row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center}
  .grow{flex:1 1 auto}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
</style>
</head>
<body>
<header class="row">
  <h1 class="grow">英文單字進階測驗（混合題型｜隨機 20 題）</h1>
  <div class="pill small">題庫：201–400</div>
</header>
<main>
  <section id="intro" class="card">
    <p class="muted">此版本已內建你的題庫（201–400）。按下「開始測驗」即可抽題。題型包含：
      <b>英→中四選一</b>、<b>中→英四選一</b>、<b>拼字題</b>、<b>填空題</b>（英文缺字）</p>
    <div class="row">
      <button id="btnStart">開始測驗</button>
      <button id="btnShowList" class="secondary">查看題庫</button>
      <div class="muted small">一次出題 20 題，結束可下載錯題 CSV。</div>
    </div>
  </section>

  <section id="quizBox" class="card hidden">
    <div class="row">
      <div>第 <span id="qIdx">1</span>/20 題　<span id="qType" class="pill small"></span></div>
      <div class="grow"></div>
      <div>得分：<b id="score">0</b></div>
    </div>
    <h2 id="question" style="margin:12px 0 8px"></h2>
    <div id="options"></div>
    <div id="inputArea" class="hidden">
      <input id="answerInput" type="text" placeholder="輸入答案後按『送出』">
      <div class="row" style="margin-top:10px">
        <button id="btnSubmit">送出</button>
        <button id="btnReveal" class="secondary">看解答</button>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnNext" class="hidden">下一題</button>
      <button id="btnFinish" class="secondary hidden">看結果</button>
    </div>
  </section>

  <section id="resultBox" class="card hidden">
    <h3>測驗完成！</h3>
    <p>總分：<b id="finalScore">0</b> / 20</p>
    <div id="review"></div>
    <div class="row" style="margin-top:10px">
      <button id="btnRetry">再測一次（再抽 20 題）</button>
      <button id="btnDownload" class="secondary">下載錯題（CSV）</button>
    </div>
  </section>

  <section id="bankBox" class="card hidden">
    <h3>題庫（201–400）</h3>
    <div class="small muted">共 <span id="bankCount"></span> 筆</div>
    <table id="bankTbl"><thead><tr><th>#</th><th>English</th><th>中文</th></tr></thead><tbody></tbody></table>
  </section>
</main>

<script>
const WORDS = [
  {en:"bottle",zh:"瓶子"},
  {en:"bowl",zh:"碗"},
  {en:"bridge",zh:"橋樑"},
  {en:"brown",zh:"棕色；咖啡色"},
  {en:"businessman",zh:"商人"},
  {en:"busy",zh:"忙；忙碌"},
  {en:"butter",zh:"奶油"},
  {en:"camera",zh:"相機"},
  {en:"careful",zh:"小心的；仔細的"},
  {en:"cell phone",zh:"手機"},
  {en:"chalk",zh:"粉筆"},
  {en:"cheap",zh:"便宜的"},
  {en:"cheat",zh:"欺騙；作弊"},
  {en:"cheese",zh:"乳酪"},
  {en:"chopstick",zh:"筷子"},
  {en:"church",zh:"教堂"},
  {en:"circle",zh:"圓形；圍起來"},
  {en:"city",zh:"城市"},
  {en:"climb",zh:"爬；攀爬"},
  {en:"coffee",zh:"咖啡"},
  {en:"collect",zh:"收集"},
  {en:"convenient",zh:"便利的"},
  {en:"copy",zh:"影印；拷貝"},
  {en:"couch",zh:"長沙發；睡椅"},
  {en:"count",zh:"數數；計算"},
  {en:"country",zh:"鄉村；國家"},
  {en:"crazy",zh:"瘋狂的"},
  {en:"cry",zh:"哭泣"},
  {en:"dangerous",zh:"危險的"},
  {en:"dark",zh:"黑暗的"},
  {en:"date",zh:"日期"},
  {en:"daughter",zh:"女兒"},
  {en:"decide",zh:"決定"},
  {en:"delicious",zh:"美味的"},
  {en:"department store",zh:"百貨公司"},
  {en:"dictionary",zh:"字典"},
  {en:"different",zh:"不同的"},
  {en:"Double Tenth Day",zh:"雙十節"},
  {en:"dozen",zh:"一打"},
  {en:"driver",zh:"司機"},
  {en:"dry",zh:"乾燥的；乾的"},
  {en:"elf",zh:"小精靈"},
  {en:"e-mail",zh:"電子郵件"},
  {en:"excellent",zh:"傑出的；優秀的"},
  {en:"excited",zh:"興奮的"},
  {en:"expensive",zh:"昂貴的"},
  {en:"factory",zh:"工廠"},
  {en:"fan",zh:"電風扇；扇子"},
  {en:"farmer",zh:"農夫"},
  {en:"fast",zh:"快的"},
  {en:"Father’s Day",zh:"父親節"},
  {en:"favorite",zh:"最愛的"},
  {en:"fall",zh:"秋天"},
  {en:"finally",zh:"最後；終於"},
  {en:"finger",zh:"手指"},
  {en:"fisherman",zh:"漁夫"},
  {en:"foreigner",zh:"外國人"},
  {en:"fork",zh:"叉子"},
  {en:"garbage",zh:"垃圾"},
  {en:"garden",zh:"花園"},
  {en:"gift",zh:"禮物"},
  {en:"glasses",zh:"眼鏡"},
  {en:"glove",zh:"手套"},
  {en:"goat",zh:"山羊"},
  {en:"grass",zh:"草"},
  {en:"gray",zh:"灰色"},
  {en:"ground",zh:"地面"},
  {en:"habit",zh:"習慣"},
  {en:"Halloween",zh:"萬聖節"},
  {en:"healthy",zh:"健康的"},
  {en:"history",zh:"歷史"},
  {en:"holiday",zh:"假日"},
  {en:"honest",zh:"誠實的；正直的"},
  {en:"horse",zh:"馬"},
  {en:"hospital",zh:"醫院"},
  {en:"hot dog",zh:"熱狗"},
  {en:"hotel",zh:"旅館"},
  {en:"hundred",zh:"百"},
  {en:"hurt",zh:"受傷；危害"},
  {en:"important",zh:"重要的"},
  {en:"Internet",zh:"網際網路"},
  {en:"island",zh:"島嶼"},
  {en:"jacket",zh:"夾克"},
  {en:"jeans",zh:"牛仔褲"},
  {en:"jog",zh:"慢跑"},
  {en:"jump",zh:"跳躍"},
  {en:"kick",zh:"踢"},
  {en:"knee",zh:"膝蓋"},
  {en:"knife",zh:"刀子"},
  {en:"lake",zh:"湖泊"},
  {en:"laugh",zh:"笑"},
  {en:"lazy",zh:"懶惰的"},
  {en:"left",zh:"左邊"},
  {en:"library",zh:"圖書館"},
  {en:"listen",zh:"聽"},
  {en:"lonely",zh:"孤獨的；單獨的"},
  {en:"lucky",zh:"幸運的"},
  {en:"machine",zh:"機器"},
  {en:"medicine",zh:"藥"},
  {en:"menu",zh:"菜單"},
  {en:"minute",zh:"分鐘"},
  {en:"mistake",zh:"錯誤"},
  {en:"Moon Festival",zh:"中秋節"},
  {en:"Mother’s Day",zh:"母親節"},
  {en:"money",zh:"金錢"},
  {en:"mountain",zh:"山；山脈"},
  {en:"movie",zh:"電影"},
  {en:"museum",zh:"博物館"},
  {en:"neck",zh:"頸部；脖子"},
  {en:"New Year’s Day",zh:"新年（元旦）"},
  {en:"noodle",zh:"麵條"},
  {en:"north",zh:"北方；北方的"},
  {en:"office",zh:"辦公室"},
  {en:"page",zh:"頁；頁數"},
  {en:"pants",zh:"褲子"},
  {en:"parents",zh:"父母親"},
  {en:"pet",zh:"寵物"},
  {en:"picnic",zh:"郊遊；野餐"},
  {en:"picture",zh:"圖畫；照片"},
  {en:"playground",zh:"操場；遊樂場"},
  {en:"police station",zh:"警察局"},
  {en:"popcorn",zh:"爆玉米花"},
  {en:"popular",zh:"受歡迎的"},
  {en:"pork",zh:"豬肉"},
  {en:"post office",zh:"郵局"},
  {en:"problem",zh:"問題；困難"},
  {en:"pull",zh:"拉"},
  {en:"push",zh:"推"},
  {en:"queen",zh:"皇后"},
  {en:"quiet",zh:"安靜的；安靜"},
  {en:"quiz",zh:"小考"},
  {en:"radio",zh:"廣播"},
  {en:"rainbow",zh:"彩虹"},
  {en:"restaurant",zh:"餐廳"},
  {en:"right",zh:"右邊；正確的"},
  {en:"river",zh:"河流"},
  {en:"road",zh:"路"},
  {en:"run",zh:"跑"},
  {en:"safe",zh:"安全的"},
  {en:"salad",zh:"沙拉"},
  {en:"salty",zh:"鹹的"},
  {en:"same",zh:"相同的；一樣的"},
  {en:"student",zh:"學生"},
  {en:"season",zh:"季節"},
  {en:"shape",zh:"形狀"},
  {en:"share",zh:"分享"},
  {en:"sheep",zh:"綿羊"},
  {en:"ship",zh:"大船"},
  {en:"shirt",zh:"襯衫"},
  {en:"shoe",zh:"鞋子"},
  {en:"shop",zh:"商店"},
  {en:"shopkeeper",zh:"店主"},
  {en:"shoulder",zh:"肩膀"},
  {en:"shy",zh:"害羞的"},
  {en:"slow",zh:"慢的"},
  {en:"smile",zh:"微笑"},
  {en:"smoke",zh:"吸煙；煙"},
  {en:"snake",zh:"蛇"},
  {en:"snowy",zh:"下雪的"},
  {en:"sock",zh:"短襪"},
  {en:"song",zh:"歌曲"},
  {en:"sound",zh:"聲響；聽起來"},
  {en:"south",zh:"南方；南方的；南部的"},
  {en:"speak",zh:"說話"},
  {en:"spoon",zh:"湯匙"},
  {en:"spring",zh:"春天；泉水"},
  {en:"story",zh:"故事"},
  {en:"stranger",zh:"陌生人"},
  {en:"street",zh:"街道"},
  {en:"successful",zh:"成功的"},
  {en:"sugar",zh:"糖"},
  {en:"summer",zh:"夏天"},
  {en:"supermarket",zh:"超級市場"},
  {en:"surprised",zh:"感到驚訝的"},
  {en:"sweater",zh:"毛衣"},
  {en:"swim",zh:"游泳"},
  {en:"Taiwan",zh:"台灣"},
  {en:"taxi",zh:"計程車"},
  {en:"Teacher’s Day",zh:"教師節"},
  {en:"telephone",zh:"電話"},
  {en:"television",zh:"電視"},
  {en:"Thanksgiving",zh:"感恩節"},
  {en:"thirsty",zh:"口渴的"},
  {en:"thousand",zh:"千"},
  {en:"tomorrow",zh:"明天"},
  {en:"traffic",zh:"交通"},
  {en:"train station",zh:"火車站"},
  {en:"truck",zh:"貨車"},
  {en:"typhoon",zh:"颱風"},
  {en:"umbrella",zh:"雨傘"},
  {en:"uniform",zh:"制服"},
  {en:"vacation",zh:"假期"},
  {en:"vegetable",zh:"蔬菜"},
  {en:"week",zh:"星期（週）"},
  {en:"weekend",zh:"週末"},
  {en:"white",zh:"白色"},
  {en:"window",zh:"窗戶"},
  {en:"winter",zh:"冬天"},
  {en:"yesterday",zh:"昨天"},
  {en:"young",zh:"年輕"}
];

// ======= helpers =======
const $=q=>document.querySelector(q);
const shuffle=arr=>arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
const pickN=(arr,n)=>shuffle(arr).slice(0,Math.min(n,arr.length));
const csvEscape=s=>`"${String(s).replaceAll('"','""')}"`;

let quiz=[],idx=0,score=0,answers=[];

function buildQuiz(){
  const types=["EN→中（選擇）","中→英（選擇）","拼字題","填空題"];
  const picked=pickN(WORDS,20);
  quiz=picked.map(base=>{
    const type=types[Math.floor(Math.random()*types.length)];
    let data={base,type,options:[],prompt:""};
    if(type==="EN→中（選擇）"){
      data.prompt=`${base.en} 的中文意思是？`;
      data.answer=base.zh;
      data.options=shuffle([base.zh,...pickN(WORDS.filter(w=>w!==base),3).map(w=>w.zh)]);
    }else if(type==="中→英（選擇）"){
      data.prompt=`「${base.zh}」的英文是？`;
      data.answer=base.en;
      data.options=shuffle([base.en,...pickN(WORDS.filter(w=>w!==base),3).map(w=>w.en)]);
    }else if(type==="拼字題"){
      data.prompt=`請輸入「${base.zh}」的英文拼字：`;
      data.answer=base.en;
    }else{ // 填空題
      // 選 1~2 個位置用 _ 取代
      const s=base.en;
      const positions = Array.from(s).map((_,i)=>i).filter(i=>/[a-zA-Z]/.test(s[i]));
      const removeCount = Math.min(2, Math.max(1, Math.floor(s.length/4)));
      const pickedPos = pickN(positions, removeCount);
      let p = s.split("");
      pickedPos.forEach(i=>p[i]="_");
      data.prompt=`補全單字：${p.join("")}（中文：${base.zh}）`;
      data.answer=base.en;
    }
    return data;
  });
}

function renderQuestion(){
  const q=quiz[idx];
  $("#qIdx").textContent=idx+1;
  $("#qType").textContent=q.type;
  $("#question").textContent=q.prompt;
  $("#options").innerHTML="";
  $("#inputArea").classList.add("hidden");
  $("#btnNext").classList.add("hidden");
  $("#btnFinish").classList.add("hidden");

  if(q.options.length){
    q.options.forEach(opt=>{
      const btn=document.createElement("button");
      btn.className="option";
      btn.textContent=opt;
      btn.onclick=()=>{
        const correct = (opt===q.answer);
        if(correct){ btn.classList.add("correct"); score++; }
        else{ btn.classList.add("wrong"); }
        [...$("#options").children].forEach(el=>{
          if(el.textContent===q.answer) el.classList.add("correct");
          el.disabled=true;
        });
        answers[idx]={q,chosen:opt,correct};
        navNext();
      };
      $("#options").appendChild(btn);
    });
  }else{
    $("#inputArea").classList.remove("hidden");
    $("#answerInput").value="";
    const submit=()=>{
      const val=$("#answerInput").value.trim().toLowerCase();
      const ok= val===q.answer.toLowerCase();
      answers[idx]={q,chosen:val,correct:ok};
      if(ok){ score++; alert("✅ 正確！"); } else { alert("❌ 正確答案是： "+q.answer); }
      navNext();
    };
    $("#btnSubmit").onclick=submit;
    $("#btnReveal").onclick=()=>{ alert("答案："+q.answer); };
  }
}

function navNext(){
  if(idx===quiz.length-1){
    $("#btnFinish").classList.remove("hidden");
    $("#btnFinish").onclick=showResult;
  }else{
    $("#btnNext").classList.remove("hidden");
    $("#btnNext").onclick=()=>{ idx++; $("#score").textContent=score; renderQuestion(); };
  }
}

function showResult(){
  $("#finalScore").textContent=score;
  $("#quizBox").classList.add("hidden");
  $("#resultBox").classList.remove("hidden");
  const wrap=document.createElement("div");
  answers.forEach((a,i)=>{
    const row=document.createElement("div");
    row.className="option "+(a.correct?"correct":"wrong");
    row.innerHTML=`${i+1}. ${a.q.base.en} – ${a.q.base.zh}<br><span class="small muted">你的答案：${a.chosen||"(空白)"}；正解：${a.q.answer}</span>`;
    wrap.appendChild(row);
  });
  const container=$("#review"); container.innerHTML=""; container.appendChild(wrap);
}

function downloadWrongCSV(){
  const wrongs = answers.filter(a=>!a.correct);
  if(!wrongs.length){ alert("恭喜！沒有錯題。"); return; }
  const rows = wrongs.map(a=>[csvEscape(a.q.base.en),csvEscape(a.q.base.zh)].join(","));
  const blob = new Blob([`English,Chinese\n${rows.join("\n")}`],{type:"text/csv;charset=utf-8;"});
  const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="wrongs.csv"; a.click();
  URL.revokeObjectURL(a.href);
}

function showBank(){
  $("#bankBox").classList.remove("hidden");
  $("#bankCount").textContent=WORDS.length;
  const tb=$("#bankTbl tbody");
  tb.innerHTML="";
  WORDS.forEach((w,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${201+i}</td><td>${w.en}</td><td>${w.zh}</td>`;
    tb.appendChild(tr);
  });
}

$("#btnStart").onclick=()=>{
  idx=0; score=0; answers=[];
  buildQuiz();
  $("#score").textContent=0;
  $("#intro").classList.add("hidden");
  $("#resultBox").classList.add("hidden");
  $("#quizBox").classList.remove("hidden");
  renderQuestion();
};
$("#btnRetry").onclick=()=>{ $("#intro").classList.remove("hidden"); $("#resultBox").classList.add("hidden"); };
$("#btnDownload").onclick=downloadWrongCSV;
$("#btnShowList").onclick=showBank;
</script>
</body>
</html>
